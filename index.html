<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>SUSI by webvariants</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">SUSI</h1>
      <h2 class="project-tagline">SUSI, a Universal System Interface</h2>
      <a href="https://github.com/webvariants/susi" class="btn">View on GitHub</a>
      <a href="https://github.com/webvariants/susi/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/webvariants/susi/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="http://webvariants.github.io/susi/resources/SUSI_Icon.svg" alt="Image of SUSI"></p>

<p>Susi is an application framework, to build interfaces to arbitary systems.
It is intended to enable even novice programmers to build robust asyncronous applications, on both ends of the system: frontend and backend.</p>

<p>For more detailed documentation please visit <a href="http://susi.readme.io/">susi.readme.io</a>.</p>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h2>

<h3>
<a id="clone" class="anchor" href="#clone" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clone</h3>

<p>First, clone the repo and its submodules from <a href="https://github.com/webvariants/susi">Github</a></p>

<pre><code>git clone --recursive https://github.com/webvariants/susi
</code></pre>

<h3>
<a id="build" class="anchor" href="#build" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build</h3>

<p>SUSI's build process is CMake based, so simply build with cmake.
After building, install the libraries and binaries and run ldconfig to update your shared library cache.</p>

<pre><code>cd $SUSI
mkdir build
cd build
cmake ..
make -j4
sudo make install
sudo ldconfig
</code></pre>

<h3>
<a id="start-the-susi-core-server" class="anchor" href="#start-the-susi-core-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start the susi-core server</h3>

<p>The main component of SUSI is its core-server. This is the server which does all event dispatching, and serves as a communication base for all other components.
You need to specify a valid TLS key / certificate pair to let the server start. To create a slef signed certificate run the following command:</p>

<pre><code>openssl req -nodes -x509 -newkey rsa:2048 -keyout server_key.pem -out server_cert.pem -days 36500
</code></pre>

<p>After this, you can start the susi-core server:</p>

<pre><code>susi-core --key server_key.pem --cert server_cert.pem --port 4000
</code></pre>

<p>This starts the susi-core server accepting TLS-connection on port 4000</p>

<h3>
<a id="start-one-or-more-services" class="anchor" href="#start-one-or-more-services" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start one or more services</h3>

<p>Once your core-server is started, you can start other components which connects to it.
One example would be, that you start the susi-duktape component, a server side javascript interpreter.
To do so, create a Javascript source file. This could look like this:</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>.*<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in processor<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span> <span class="pl-k">=</span> {};
    susi.<span class="pl-c1">ack</span>(evt);
});

susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 1<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">ack</span>(evt);
});

susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 2<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">b</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">dismiss</span>(evt);
});

susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 3 (should never be called)<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">c</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>baz<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">ack</span>(evt);
});

susi.<span class="pl-c1">registerConsumer</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>consumer:<span class="pl-pds">'</span></span>, evt.<span class="pl-c1">payload</span>);
});

susi.<span class="pl-c1">publish</span>({ topic<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> }, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>finish:<span class="pl-pds">'</span></span>, evt.<span class="pl-c1">payload</span>);
});
</pre></div>

<p>Place this file somewhere in your filesystem with the name susi-sample.js.
You can use the same key/certificate pair you used to start the server, but you can create another pair:</p>

<pre><code>openssl req -nodes -x509 -newkey rsa:2048 -keyout duktape_key.pem -out duktape_cert.pem -days 36500
</code></pre>

<p>Now its time to start susi-duktape.</p>

<pre><code>susi-duktape --src susi-sample.js --addr localhost --port 4000 --key duktape_key.pem --cert duktape_cert.pem
&gt; started Susi::duktape engine and loaded source.js
&gt; 2015-08-25T09:35:31.934Z DBG susi-js: source.js:2: in processor
&gt; 2015-08-25T09:35:31.934Z DBG susi-js: source.js:8: in foo proc 1
&gt; 2015-08-25T09:35:31.934Z DBG susi-js: source.js:14: in foo proc 2
&gt; 2015-08-25T09:35:31.934Z INF susi-js: consumer: {a:"foo",b:"bar"}
&gt; 2015-08-25T09:35:31.935Z INF susi-js: finish: {a:"foo",b:"bar"}
</code></pre>

<p>If you see an output like this, everything's fine :)
If you have a look at the supplied JS sources, you can see how SUSI works.</p>

<h3>
<a id="understand-the-code" class="anchor" href="#understand-the-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Understand the code</h3>

<p>There are 5 essential actions you need to know about:</p>

<ul>
<li>registerProcessor()

<ul>
<li>This attaches an active event handler to a specific topic.</li>
<li>All active event handlers run sequentially in the order they are declared.</li>
</ul>
</li>
<li>registerConsumer()

<ul>
<li>This attaches an passive event handler to a specific topic</li>
<li>All passive event handlers run after all active event handlers finished.</li>
</ul>
</li>
<li>publish()

<ul>
<li>This publishes an event.</li>
<li>The event is firstly processed by all processors</li>
<li>After all processors finished, the consumers for this topic are called</li>
</ul>
</li>
<li>ack()

<ul>
<li>This needs to be called when an processor finished.</li>
<li>It tells susi, to continue with the event processing.</li>
</ul>
</li>
<li>dismiss()

<ul>
<li>This can also be called if a processor finished</li>
<li>It tells SUSI to stop the event processing -&gt; no active handlers will be called after this</li>
<li>It will NOT stop passive handlers or the finish callback from being called</li>
</ul>
</li>
</ul>

<p>As you see in the example, we register four processors:</p>

<pre><code>susi.registerProcessor('.*', function (evt) {
    console.debug('in processor');
    evt.payload = {};
    susi.ack(evt);
});
</code></pre>

<p>This is the first processor. It takes a string/regex to specify the event topic this processor is interested in,
and a callback which is called. The first processor matches all events (topic: ".*") and ensures that the
event payload is an empty object. Notice that we call ack() at the end, to tell susi that the event can now be processed by
other processors.</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 1<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">ack</span>(evt);
});</pre></div>

<p>This is the second processor. It matches all events with the topic 'foo'.
It attaches the string 'foo' to the payload field 'a'. After this, it acknoledges the event back to susi.</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 2<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">b</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">dismiss</span>(evt);
});</pre></div>

<p>This is the third processor. It also matches all events with the topic 'foo'.
Notice that we call dismiss() in the end of the callback. This prevents all later declared processors to be called.
Especially fourth processor we declared after this, will NOT be called.</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">registerProcessor</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">debug</span>(<span class="pl-s"><span class="pl-pds">'</span>in foo proc 3 (should never be called)<span class="pl-pds">'</span></span>);
    evt.<span class="pl-c1">payload</span>.<span class="pl-c1">c</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>baz<span class="pl-pds">'</span></span>;
    susi.<span class="pl-c1">ack</span>(evt);
});</pre></div>

<p>This is the fourth processor. It will never be called due to the dismiss() statement in the third processor.</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">registerConsumer</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>consumer:<span class="pl-pds">'</span></span>, evt.<span class="pl-c1">payload</span>);
});</pre></div>

<p>Here we declared a Consumer / passive event handler.
It gets called after all processors, which are interested in this event, finished.
In the callback we simply log the event payload to stdout.</p>

<div class="highlight highlight-javascript"><pre>susi.<span class="pl-c1">publish</span>({ topic<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> }, <span class="pl-k">function</span> (<span class="pl-smi">evt</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>finish:<span class="pl-pds">'</span></span>, evt.<span class="pl-c1">payload</span>);
});</pre></div>

<p>Now after the setup of all those processors and consumers, we can finally publish an event!
publish() takes the event as first parameter. All events MUST have a topic field. Additionally they can have a payload field
which can contain arbitary data. As a second argument you can specify a finish callback. This is somewhat a one-time-consumer.
It gets called after all processors for this event finished, but gets immediatly deleted afterwards.</p>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h2>

<p>Tino Rusch, Thomas Krause, Christian Sonderfeld</p>

<h3>
<a id="third-party-libraries" class="anchor" href="#third-party-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Third party libraries</h3>

<ul>
<li><a href="https://github.com/boostorg/boost">Boost</a></li>
<li><a href="https://github.com/openssl/openssl">OpenSSL</a></li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<ul>
<li>see <a href="https://github.com/webvariants/susi/blob/experimental/LICENSE.md">LICENSE</a> file</li>
</ul>

<h2>
<a id="contact" class="anchor" href="#contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contact</h2>

<h4>
<a id="developercompany" class="anchor" href="#developercompany" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developer/Company</h4>

<ul>
<li>Homepage: <a href="http://www.webvariants.de">www.webvariants.de</a>
</li>
<li>e-mail: tino[<em>dot</em>]rusch[<em>at</em>]webvariants[<em>dot</em>]de</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/webvariants/susi">SUSI</a> is maintained by <a href="https://github.com/webvariants">webvariants</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
